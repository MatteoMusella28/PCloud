<!DOCTYPE HTML>
<!--
    Landed by Matteo Musella
-->
<html>
    <head>
        <title>HydroSophia</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/main.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    </head>
    <body class="is-preload">
        <div id="page-wrapper">

            <!-- Header -->
            <header id="header">
                <h1 id="logo"><a href="home.html">HydroSophia</a></h1>
                <nav id="nav">
                    <ul>
                        <li><a href="home.html">Home</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="valves.html">Valves</a></li>
                        <li><a href="aboutus.html">About Us</a></li>
                        <li>
							<a href="#">Language</a>
							<ul>
								<li><a href="casa.html">Italian</a></li>
								<li><a href="home.html">English</a></li>
							</ul>
						</li>
                    </ul>
                </nav>
            </header>

            <!-- Main -->
            <div id="main" class="wrapper style1">
                <div class="container">
                    <header class="major">
                        <h2>DASHBOARD</h2>
                        <p>"HydroSophia: intelligent water at the service of your land"</p>
                    </header>

					<!-- Graph Section -->
					<section id="content">
						<h3>GRAPH 1 - MOISTURE x TIME</h3>
						<div id="chart_div" style="width: 1200px; height: 800px;"></div>
						<hr>
						<h3>GRAPH 2 - VALVE x TIME</h3>
						<div id="chart_div_valve" style="width: 1200px; height: 400px;"></div>
					</section>
				</div>
			</div>

			<!-- KPI Section -->
				<section id="four" class="wrapper style1 special fade-up">
					<div class="container">
						<header class="major">
							<h2>KPIs</h2>
						</header>
						<div class="box alt">
							<div class="row gtr-uniform">
								<section class="col-4 col-6-medium col-12-xsmall">
									<span class="icon solid alt major fa-chart-area"></span>
									<h3>Average Soil Moisture</h3>
									<div class="mean-moisture" id="moist_div"></div>
									<p>Measures the average soil moisture percentage during the monitored period, helping to assess the irrigation system's ability to maintain optimal moisture levels.</p>
								</section>
								<section class="col-4 col-6-medium col-12-xsmall">
									<span class="icon solid alt major fa-comment"></span>
									<h3>Total Water Volume Used</h3>
									<div class="total-water" id="total_water_div"></div>
									<p>Tracks the total amount of water (in liters) applied to the field, giving insight into the system's overall water consumption and efficiency.</p>
								</section>
								<section class="col-4 col-6-medium col-12-xsmall">
									<span class="icon solid alt major fa-flask"></span>
									<h3>Average Valve Open Time</h3>
									<div class="mean-valve-time" id="mean_valve_time_div"></div>
									<p>Calculates the average duration the valve remains open, indicating the typical irrigation session length and water flow.</p>
								</section>
								<section class="col-4 col-6-medium col-12-xsmall">
									<span class="icon solid alt major fa-paper-plane"></span>
									<h3>Valve Opening Frequency</h3>
									<div class="valve-frequency" id="valve_frequency_div"></div>
									<p>Counts how often the valve is opened throughout the monitored period, providing a sense of irrigation frequency.</p>
								</section>
								<section class="col-4 col-6-medium col-12-xsmall">
									<span class="icon solid alt major fa-file"></span>
									<h3>Water Use Efficiency</h3>
									<div class="water_efficiency_with_symbol" id="water_efficiency_div"></div>
									<p>Compares the total water volume used to the average soil moisture, evaluating how efficiently water is used to maintain desired moisture levels.</p>
								</section>
								<section class="col-4 col-6-medium col-12-xsmall">
									<span class="icon solid alt major fa-lock"></span>
									<h3>Soil Moisture Variation</h3>
									<div class="moisture-variation" id="moisture_variation_div"></div>
									<p>Analyzes the fluctuation in soil moisture over time, helping to understand how well the system adapts to changes in soil conditions.</p>
								</section>
							</div>
						</div>
					</div>
				</section>

            <!-- Footer -->
				<footer id="footer">
					<ul class="icons">
						<li><a href="https://www.facebook.com/matteo.musella" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
						<li><a href="https://www.linkedin.com/in/matteomusella/" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
						<li><a href="https://www.instagram.com/im.mvsh/" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="https://github.com/MatteoMusella28" class="icon brands alt fa-github"><span class="label">GitHub</span> </a></li>
						<li><a href="mailto:matteo.musella.28@gmail.com" class="icon solid alt fa-envelope"><span class="label">Email</span></a></li>
					</ul>
					<ul class="copyright">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="https://github.com/MatteoMusella28">Matteo Musella</a></li>
					</ul>
				</footer>
        </div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/jquery.dropotron.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript">
			$.get("http://localhost/sensors/s1",function(datav, status){
				//console.log(datav)
				datav = JSON.parse(datav)
				console.log(datav)
				data_first_graph = datav.map(innerList => [innerList[0], innerList[1]])
				data_second_graph = datav.map(innerList => [innerList[0], innerList[2]])
				console.log(data_first_graph)
				google.charts.load('current', {packages: ['corechart', 'line']});
				google.charts.setOnLoadCallback(drawBasic);
				google.charts.setOnLoadCallback(drawKPIs);
				function drawBasic() {

					  var data1 = new google.visualization.DataTable();
					  data1.addColumn('string', 'Time');
					  data1.addColumn('number', 'Moisture');
					  data1.addRows(data_first_graph);
					  var options1 = {
						hAxis: {
						  title: 'Time'
						},
						vAxis: {
						  title: 'Moisture'
						}
					  };
					  var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
					  chart.draw(data1, options1);
					  
					  var data2 = new google.visualization.DataTable();
					  data2.addColumn('string', 'Time');
					  data2.addColumn('number', 'Valve');
					  data2.addRows(data_second_graph);
					  var options1 = {
						hAxis: {
						  title: 'Time'
						},
						vAxis: {
						  title: 'Valve'
						}
					  };
					  var chart = new google.visualization.LineChart(document.getElementById('chart_div_valve'));
					  chart.draw(data2, options1);
				   }
			})

			function drawKPIs() {
				$.get("http://localhost/sensors/s1/meansoil", function(data) {
					$("#moist_div").text(JSON.parse(data)[0]);
				});
				$.get("http://localhost/sensors/s1/totalwater", function(data) {
					$("#total_water_div").text(JSON.parse(data)[0]);
				});
				$.get("http://localhost/sensors/s1/meantimevalve", function(data) {
					$("#mean_valve_time_div").text(JSON.parse(data)[0]);
				});
				$.get("http://localhost/sensors/s1/valvefrequency", function(data) {
					$("#valve_frequency_div").text(JSON.parse(data)[0]);
				});
				$.get("http://localhost/sensors/s1/waterefficiency", function(data) {
					$("#water_efficiency_div").text(JSON.parse(data)[0]);
				});
				$.get("http://localhost/sensors/s1/moisturevariation", function(data) {
					$("#moisture_variation_div").text(JSON.parse(data)[0]);
				});
			}
		</script>
    </body>
</html>
